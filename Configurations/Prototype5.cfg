
/* my test app*/
+StateMachine = {
	Class = StateMachine
	+INITIAL = {
		Class = ReferenceContainer
		+Start = {
			Class = StateMachineEvent
			NextState = "WAITSTANDBY"
			NextStateError = "ERROR"
            +PrepareNextStateOnOurRTApp = {
        		Class = Message
        		Destination = MyApp
        		Mode = ExpectsReply
        		Function = PrepareNextState
        		+Parameters = {
        			Class = ConfigurationDatabase
        			param1 = WaitStandby
        		}
        	}

	        +StartNextStateExecution = {
        		Class = Message
        		Destination = MyApp 
        		Function = StartNextStateExecution
        		Mode = ExpectsReply
	        }		
		}
	}
	
	+WAITSTANDBY = {
		Class = ReferenceContainer
		/* GoOffline is one of command to be executed.*/
		+GoOffline = {
			Class = StateMachineEvent
			NextState = "OFFLINE"
			NextStateError = "ERROR"
            +PrepareNextStateOnOurRTApp = {
        		Class = Message
        		Destination = MyApp
        		Mode = ExpectsReply
        		Function = PrepareNextState
        		+Parameters = {
        			Class = ConfigurationDatabase
        			param1 = Offline
        		}
        	}
			+StopCurrentStateExecution = {
        		Class = Message
        		Destination = MyApp 
        		Function = StopCurrentStateExecution
        		Mode = ExpectsReply
	        }
	        +StartNextStateExecution = {
        		Class = Message
        		Destination = MyApp 
        		Function = StartNextStateExecution
        		Mode = ExpectsReply
	        }
		}
		+GoError = {  /* This is a line to receive event from RT Application */
			Class = StateMachineEvent
			NextState = "ERROR"
			NextStateError = "ERROR"
			+PrepareNextStateOnOurRTApp = { /*This code is executed in SM*/
				Class = Message
				Destination = MyApp
				Mode = ExpectsReply
				Function = PrepareNextState
				+Parameters = {
					Class = ConfigurationDatabase
					param1 = Error
				}
			}
			+StopCurrentStateExecution = {
        		Class = Message
        		Destination = MyApp 
        		Function = StopCurrentStateExecution
        		Mode = ExpectsReply
	        }
	        +StartNextStateExecution = {
        		Class = Message
        		Destination = MyApp 
        		Function = StartNextStateExecution
        		Mode = ExpectsReply
	        }
		}
	}
	
	+OFFLINE = {
		Class = ReferenceContainer
		/* GoOffline is one of command to be executed.*/
		+GoPreHeating = {
			Class = StateMachineEvent
			NextState = "WAITPERMIT"
			NextStateError = "ERROR"
            +PrepareNextStateOnOurRTApp = {
        		Class = Message
        		Destination = MyApp
        		Mode = ExpectsReply
        		/* The following function is executed in RT app.*/
        		Function = PrepareNextState
        		+Parameters = {
        			Class = ConfigurationDatabase
        			param1 = WaitPermit
        		}
        	}
			+StopCurrentStateExecution = {
        		Class = Message
        		Destination = MyApp 
        		Function = StopCurrentStateExecution
        		Mode = ExpectsReply
	        }
	        +StartNextStateExecution = {
        		Class = Message
        		Destination = MyApp 
        		Function = StartNextStateExecution
        		Mode = ExpectsReply
	        }
		}
		+GoError = {  /* This is a line to receive event from RT Application */
			Class = StateMachineEvent
			NextState = "ERROR"
			NextStateError = "ERROR"
			+PrepareNextStateOnOurRTApp = { /*This code is executed in SM*/
				Class = Message
				Destination = MyApp
				Mode = ExpectsReply
				Function = PrepareNextState
				+Parameters = {
					Class = ConfigurationDatabase
					param1 = Error
				}
			}
			+StopCurrentStateExecution = {
        		Class = Message
        		Destination = MyApp 
        		Function = StopCurrentStateExecution
        		Mode = ExpectsReply
	        }
	        +StartNextStateExecution = {
        		Class = Message
        		Destination = MyApp 
        		Function = StartNextStateExecution
        		Mode = ExpectsReply
	        }
		}
	}
	
	+WAITPERMIT = {
		Class = ReferenceContainer
		+GoHeating = {
			Class = StateMachineEvent
			NextState = "PREHEATING"
			NextStateError = "ERROR"
			+PrepareNextStateOnOurRTApp = {
        		Class = Message
        		Destination = MyApp
        		Mode = ExpectsReply
        		Function = PrepareNextState
        		+Parameters = {
        			Class = ConfigurationDatabase
        			param1 = PreHeating
        		}
        	}			
			}
			+StopCurrentStateExecution = {
        		Class = Message
        		Destination = MyApp 
        		Function = StopCurrentStateExecution
        		Mode = ExpectsReply			
			}
			+StartNextStateExecution = {
        		Class = Message
        		Destination = MyApp 
        		Function = StartNextStateExecution
        		Mode = ExpectsReply			
			}
		}
		+GoError = {
			Class = StateMachineEvent
			NextState = "ERROR"
			NextStateError = "ERROR"
			+PrepareNextStateOnOurRTApp = { /*This code is executed in SM*/
				Class = Message
				Destination = MyApp
				Mode = ExpectsReply
				Function = PrepareNextState
				+Parameters = {
					Class = ConfigurationDatabase
					param1 = Error
				}
			}
			+StopCurrentStateExecution = {
        		Class = Message
        		Destination = MyApp 
        		Function = StopCurrentStateExecution
        		Mode = ExpectsReply
	        }
	        +StartNextStateExecution = {
        		Class = Message
        		Destination = MyApp 
        		Function = StartNextStateExecution
        		Mode = ExpectsReply
	        }		
		}
	}
	
	+PREHEATING = {
		Class = ReferenceContainer
		+GoWaitReady = {
			Class = StateMachineEvent
			NextState = "WAITREADY"
			NextStateError = "ERROR"
            +PrepareNextStateOnOurRTApp = {
        		Class = Message
        		Destination = MyApp
        		Mode = ExpectsReply
        		/* The following function is executed in RT app.*/
        		Function = PrepareNextState
        		+Parameters = {
        			Class = ConfigurationDatabase
        			param1 = WaitReady
        		}
        	}
			+StopCurrentStateExecution = {
        		Class = Message
        		Destination = MyApp 
        		Function = StopCurrentStateExecution
        		Mode = ExpectsReply
	        }
	        +StartNextStateExecution = {
        		Class = Message
        		Destination = MyApp 
        		Function = StartNextStateExecution
        		Mode = ExpectsReply
	        }
		}
		+GoError = {  /* This is a line to receive event from RT Application */
			Class = StateMachineEvent
			NextState = "ERROR"
			NextStateError = "ERROR"
			+PrepareNextStateOnOurRTApp = { /*This code is executed in SM*/
				Class = Message
				Destination = MyApp
				Mode = ExpectsReply
				Function = PrepareNextState
				+Parameters = {
					Class = ConfigurationDatabase
					param1 = Error
				}
			}
			+StopCurrentStateExecution = {
        		Class = Message
        		Destination = MyApp 
        		Function = StopCurrentStateExecution
        		Mode = ExpectsReply
	        }
	        +StartNextStateExecution = {
        		Class = Message
        		Destination = MyApp 
        		Function = StartNextStateExecution
        		Mode = ExpectsReply
	        }
		}
	}
	
	+WAITREADY = {
		Class = ReferenceContainer
		+GoWaitHVON = {
			Class = StateMachineEvent
			NextState = "WAITHVON"
			NextStateError = "ERROR"
            +PrepareNextStateOnOurRTApp = {
        		Class = Message
        		Destination = MyApp
        		Mode = ExpectsReply
        		/* The following function is executed in RT app.*/
        		Function = PrepareNextState
        		+Parameters = {
        			Class = ConfigurationDatabase
        			param1 = HVON
        		}
        	}
			+StopCurrentStateExecution = {
        		Class = Message
        		Destination = MyApp 
        		Function = StopCurrentStateExecution
        		Mode = ExpectsReply
	        }
	        +StartNextStateExecution = {
        		Class = Message
        		Destination = MyApp 
        		Function = StartNextStateExecution
        		Mode = ExpectsReply
	        }		
		}
		+GoError= {
			Class = StateMachineEvent
			NextState = "ERROR"
			NextStateError = "ERROR"
			+PrepareNextStateOnOurRTApp = { /*This code is executed in SM*/
				Class = Message
				Destination = MyApp
				Mode = ExpectsReply
				Function = PrepareNextState
				+Parameters = {
					Class = ConfigurationDatabase
					param1 = Error
				}
			}
			+StopCurrentStateExecution = {
        		Class = Message
        		Destination = MyApp 
        		Function = StopCurrentStateExecution
        		Mode = ExpectsReply
	        }
	        +StartNextStateExecution = {
        		Class = Message
        		Destination = MyApp 
        		Function = StartNextStateExecution
        		Mode = ExpectsReply
	        }		
		}
		
	}
	+WAITHVON = {
		Class = ReferenceContainer
		+GoHvArming = {
			Class = StateMachineEvent
			NextState = "HVARMING"
			NextStateError = "ERROR"
            +PrepareNextStateOnOurRTApp = {
        		Class = Message
        		Destination = MyApp
        		Mode = ExpectsReply
        		/* The following function is executed in RT app.*/
        		Function = PrepareNextState
        		+Parameters = {
        			Class = ConfigurationDatabase
        			param1 = HVArming
        		}
        	}
			+StopCurrentStateExecution = {
        		Class = Message
        		Destination = MyApp 
        		Function = StopCurrentStateExecution
        		Mode = ExpectsReply
	        }
	        +StartNextStateExecution = {
        		Class = Message
        		Destination = MyApp 
        		Function = StartNextStateExecution
        		Mode = ExpectsReply
	        }	
		}
		+GoError = {
			Class = StateMachineEvent
			NextState = "ERROR"
			NextStateError = "ERROR"
			+PrepareNextStateOnOurRTApp = { /*This code is executed in SM*/
				Class = Message
				Destination = MyApp
				Mode = ExpectsReply
				Function = PrepareNextState
				+Parameters = {
					Class = ConfigurationDatabase
					param1 = Error
				}
			}
			+StopCurrentStateExecution = {
        		Class = Message
        		Destination = MyApp 
        		Function = StopCurrentStateExecution
        		Mode = ExpectsReply
	        }
	        +StartNextStateExecution = {
        		Class = Message
        		Destination = MyApp 
        		Function = StartNextStateExecution
        		Mode = ExpectsReply
	        }		
		}
		
	}
	+HVARMING = {
		Class = ReferenceContainer
		+GoHvArmed = {
			Class = StateMachineEvent
			NextState = "HVARMED"
			NextStateError = "ERROR"
            +PrepareNextStateOnOurRTApp = {
        		Class = Message
        		Destination = MyApp
        		Mode = ExpectsReply
        		/* The following function is executed in RT app.*/
        		Function = PrepareNextState
        		+Parameters = {
        			Class = ConfigurationDatabase
        			param1 = HVArmed
        		}
        	}
			+StopCurrentStateExecution = {
        		Class = Message
        		Destination = MyApp 
        		Function = StopCurrentStateExecution
        		Mode = ExpectsReply
	        }
	        +StartNextStateExecution = {
        		Class = Message
        		Destination = MyApp 
        		Function = StartNextStateExecution
        		Mode = ExpectsReply
	        }			
		}
		+GoError = {
			Class = StateMachineEvent
			NextState = "ERROR"
			NextStateError = "ERROR"
			+PrepareNextStateOnOurRTApp = { /*This code is executed in SM*/
				Class = Message
				Destination = MyApp
				Mode = ExpectsReply
				Function = PrepareNextState
				+Parameters = {
					Class = ConfigurationDatabase
					param1 = Error
				}
			}
			+StopCurrentStateExecution = {
        		Class = Message
        		Destination = MyApp 
        		Function = StopCurrentStateExecution
        		Mode = ExpectsReply
	        }
	        +StartNextStateExecution = {
        		Class = Message
        		Destination = MyApp 
        		Function = StartNextStateExecution
        		Mode = ExpectsReply
	        }		
		}
	}
	+HVARMED = {
		Class = ReferenceContainer
		+GoHvInjection = {
			Class = StateMachineEvent
			NextState = "HVINJECTION"
			NextStateError = "ERROR"
            +PrepareNextStateOnOurRTApp = {
        		Class = Message
        		Destination = MyApp
        		Mode = ExpectsReply
        		/* The following function is executed in RT app.*/
        		Function = PrepareNextState
        		+Parameters = {
        			Class = ConfigurationDatabase
        			param1 = HVInjection
        		}
        	}
			+StopCurrentStateExecution = {
        		Class = Message
        		Destination = MyApp 
        		Function = StopCurrentStateExecution
        		Mode = ExpectsReply
	        }
	        +StartNextStateExecution = {
        		Class = Message
        		Destination = MyApp 
        		Function = StartNextStateExecution
        		Mode = ExpectsReply
	        }				
		}
		+GoOffline = {
			Class = StateMachineEvent
			NextState = "OFFLINE"
			NextStateError = "ERROR"
            +PrepareNextStateOnOurRTApp = {
        		Class = Message
        		Destination = MyApp
        		Mode = ExpectsReply
        		/* The following function is executed in RT app.*/
        		Function = PrepareNextState
        		+Parameters = {
        			Class = ConfigurationDatabase
        			param1 = Offline
        		}
        	}
			+StopCurrentStateExecution = {
        		Class = Message
        		Destination = MyApp 
        		Function = StopCurrentStateExecution
        		Mode = ExpectsReply
	        }
	        +StartNextStateExecution = {
        		Class = Message
        		Destination = MyApp 
        		Function = StartNextStateExecution
        		Mode = ExpectsReply
	        }			
		}
		+GoError = {
			Class = StateMachineEvent
			NextState = "ERROR"
			NextStateError = "ERROR"
			+PrepareNextStateOnOurRTApp = { /*This code is executed in SM*/
				Class = Message
				Destination = MyApp
				Mode = ExpectsReply
				Function = PrepareNextState
				+Parameters = {
					Class = ConfigurationDatabase
					param1 = Error
				}
			}
			+StopCurrentStateExecution = {
        		Class = Message
        		Destination = MyApp 
        		Function = StopCurrentStateExecution
        		Mode = ExpectsReply
	        }
	        +StartNextStateExecution = {
        		Class = Message
        		Destination = MyApp 
        		Function = StartNextStateExecution
        		Mode = ExpectsReply
	        }		
		}
	}
	+HVINJECTION = {
		Class = ReferenceContainer
		+GoRFON = {
			Class = StateMachineEvent
			NextState = "RFON"
			NextStateError = "ERROR"
            +PrepareNextStateOnOurRTApp = {
        		Class = Message
        		Destination = MyApp
        		Mode = ExpectsReply
        		/* The following function is executed in RT app.*/
        		Function = PrepareNextState
        		+Parameters = {
        			Class = ConfigurationDatabase
        			param1 = RFON
        		}
        	}
			+StopCurrentStateExecution = {
        		Class = Message
        		Destination = MyApp 
        		Function = StopCurrentStateExecution
        		Mode = ExpectsReply
	        }
	        +StartNextStateExecution = {
        		Class = Message
        		Destination = MyApp 
        		Function = StartNextStateExecution
        		Mode = ExpectsReply
	        }			
		}
		+GoError = {
			Class = StateMachineEvent
			NextState = "ERROR"
			NextStateError = "ERROR"
			+PrepareNextStateOnOurRTApp = { /*This code is executed in SM*/
				Class = Message
				Destination = MyApp
				Mode = ExpectsReply
				Function = PrepareNextState
				+Parameters = {
					Class = ConfigurationDatabase
					param1 = Error
				}
			}
			+StopCurrentStateExecution = {
        		Class = Message
        		Destination = MyApp 
        		Function = StopCurrentStateExecution
        		Mode = ExpectsReply
	        }
	        +StartNextStateExecution = {
        		Class = Message
        		Destination = MyApp 
        		Function = StartNextStateExecution
        		Mode = ExpectsReply
	        }		
		}
	}
	+RFON = {
		Class = ReferenceContainer
		+GoHvArmed = {
			Class = StateMachineEvent
			NextState = "HVARMED"
			NextStateError = "ERROR"
            +PrepareNextStateOnOurRTApp = {
        		Class = Message
        		Destination = MyApp
        		Mode = ExpectsReply
        		/* The following function is executed in RT app.*/
        		Function = PrepareNextState
        		+Parameters = {
        			Class = ConfigurationDatabase
        			param1 = HVArmed
        		}
        	}
			+StopCurrentStateExecution = {
        		Class = Message
        		Destination = MyApp 
        		Function = StopCurrentStateExecution
        		Mode = ExpectsReply
	        }
	        +StartNextStateExecution = {
        		Class = Message
        		Destination = MyApp 
        		Function = StartNextStateExecution
        		Mode = ExpectsReply
	        }			
		}
		+GoError = {
			Class = StateMachineEvent
			NextState = "ERROR"
			NextStateError = "ERROR"
			+PrepareNextStateOnOurRTApp = { /*This code is executed in SM*/
				Class = Message
				Destination = MyApp
				Mode = ExpectsReply
				Function = PrepareNextState
				+Parameters = {
					Class = ConfigurationDatabase
					param1 = Error
				}
			}
			+StopCurrentStateExecution = {
        		Class = Message
        		Destination = MyApp 
        		Function = StopCurrentStateExecution
        		Mode = ExpectsReply
	        }
	        +StartNextStateExecution = {
        		Class = Message
        		Destination = MyApp 
        		Function = StartNextStateExecution
        		Mode = ExpectsReply
	        }		
		}
	}

	
	/*
	*   Whenever PS emits fault signal, the state machine enter the error state.
	*/
	+ERROR = {
		Class = ReferenceContainer
		/* GoOffline is one of command to be executed.*/
		+GoReset = {
			Class = StateMachineEvent
			NextState = "WAITSTANDBY"
			NextStateError = "ERROR"
            +PrepareNextStateOnOurRTApp = {
        		Class = Message
        		Destination = MyApp
        		Mode = ExpectsReply
        		/* The following function is executed in RT app.*/
        		Function = PrepareNextState
        		+Parameters = {
        			Class = ConfigurationDatabase
        			param1 = WaitStandby
        		}
        		
        	}
        	+StopCurrentStateExecution = {
        		Class = Message
        		Destination = MyApp 
        		Function = StopCurrentStateExecution
        		Mode = ExpectsReply
	        }
	        +StartNextStateExecution = {
        		Class = Message
        		Destination = MyApp 
        		Function = StartNextStateExecution
        		Mode = ExpectsReply
	        }
		}
		
	}	
}	

+MyApp = {
	Class = RealTimeApplication
	+Functions = {
	    Class = ReferenceContainer
	    /*Nodes under the Function node is GAMs configuration to be executed in RTApp thread.*/
	    +TimerGAM = {
            Class = IOGAM
            InputSignals = {
                Counter = {
                    DataSource = Timer
                    Type = uint32
                    Frequency = 1  /* Hz */
                }
            }
            OutputSignals = {
                Counter = {
                    DataSource = Display
                    Type = int32
                }
            }
        }
        
        +preProgrammedGAM = {
        	Class = JAPreProgrammedGAM
        	InputSignals = {
        	/*Monitor PrePro ON/OFF, File load trigger, File name*/
        	}
        	OutputSignals = {
        	/*Write File Load State.*/
        	}
        
        }
        
        +WaitStandbyMessageGAM = {
            Class = JAMessageGAM /*JAMessageGAM will be developed.*/
            InputSignals = {
                Standby = { /* Signal name*/
                    DataSource = EPICSCAInput
                    Type = uint32
                }
                
            }
            /* following message is sent when signal state (standby) becomes 1.*/
            +Event = {
        		Class = Message
        		Destination = StateMachine 
        		Function = GoOffline  /* The GoOffline event in State Machine is called.*/
        		Mode = ExpectsReply
	        }
        }
        +OfflineMessageGAM = {
            Class = JAMessageGAM 
            Operation = AND
            InputSignals = {
                Ready1 = { /* Signal name*/
                    DataSource = EPICSCAInput
                    Type = uint32
                }
                Ready2 = { /* Signal name*/
                    DataSource = EPICSCAInput
                    Type = uint32
                }
                
            }
            /* following message is sent when signal state (standby) becomes 1.*/
            +Event = {
        		Class = Message
        		Destination = StateMachine 
        		Function = GoWaitPermit
        		Mode = ExpectsReply
	        }
        }
        +WaitPermitMessageGAM = {
        	Class = JAMessageGAM
        	InputSignals = {
        		BEAMONPERMIT = { 
        			DataSource = EPICSCAInput
        			Type = uint32
        		}
        	}
        	+Event = {
        	    Class = Message
        		Destination = StateMachine
        		Function = GoPreHeating
        		Mode = ExpectsReply
        	}
        }
        +PreHeatingMessageGAM = {
        /* If prepro mode is ON, then, execute periodical parameter update.
        *  Otherwise just pass through states
        */
        	Class = JAMessageGAM
        	InputSignals = {
        		GYAPREPRO = { 
        			DataSource = EPICSCAInput
        			Type = uint32
        		}
        	}
        	+Event = {
        	    Class = Message
        		Destination = StateMachine
        		Function = GoWaitReady
        		Mode = ExpectsReply
        	}
        }
        +WaitReadyMessageGAM = {
        	Class = JAMessageGAM
        	InputSignals = {
        		GYAAPSREADY = { 
        			DataSource = EPICSCAInput
        			Type = uint32
        		}
        		GYABPSREADY = { 
        			DataSource = EPICSCAInput
        			Type = uint32
        		}
        	}
        	+Event = {
        	    Class = Message
        		Destination = StateMachine
        		Function = GoWaitHVON
        		Mode = ExpectsReply
        	}
        }
        +WaitHVONMessageGAM = {
        	Class = JAMessageGAM
        	InputSignals = {
        		HVON = { 
        			DataSource = EPICSCAInput
        			Type = uint32
        		}
        	}
        	+Event = {
        	    Class = Message
        		Destination = StateMachine
        		Function = GoHVArming
        		Mode = ExpectsReply
        	}
        }
        +HVArmingMessageGAM = {
        	Class = JAMessageGAM
        	InputSignals = {
        		GYAAPSHVDT = { 
        			DataSource = EPICSCAInput
        			Type = uint32
        		}
        		GYABPSHVDT = {
        			DataSource = EPICSCAInput
        			Type = uint32
        		}
        	}
        	+Event = {
        	    Class = Message
        		Destination = StateMachine
        		Function = GoHVArmed
        		Mode = ExpectsReply
        	}
        }
        +HVArmedMessageGAM = {
        	Class = JAMessageGAM
        	InputSignals = {

        	}
        	+Event = {
        	    Class = Message
        		Destination = StateMachine
        		Function = GoHVInjection
        		Mode = ExpectsReply
        	}
        }
        +HVInjectionMessageGAM = {
        	Class = JAMessageGAM
        	InputSignals = {
        		GYAPSSWON = { 
        			DataSource = EPICSCAInput
        			Type = uint32
        		}
        		GYAAPSDT = {
        			DataSource = EPICSCAInput
        			Type = uint32
        		}
        		GYABPSSWON = {
         			DataSource = EPICSCAInput
        			Type = uint32       			
        		}  
        		GYABPSSWDT {
        			DataSource = EPICSCAInput
        			Type = uint32        		
        		}      	
        	}
        	+Event = {
        	    Class = Message
        		Destination = StateMachine
        		Function = GoRFON
        		Mode = ExpectsReply
        	}
        }
        +RFONMessageGAM = {
        	Class = JAMessageGAM  /* This base class may need updated.*/
        	InputSignals = {
        		GYASHOTLEN = { 
        			DataSource = EPICSCAInput
        			Type = uint32
        		}
        		ElapsedTime = {
        			SataSource = Timer
        			Type = uint32
        			Frequency = 1 /*Hz*/
        		}
        	}
        	OutputSignals = {
        		APSHVON = {
        			DataSource = EPICSCAOutput
        			Type = uint32
        		}
        		BPSHVON = {
        			DataSource = EPICSCAOutput
        			Type = uint32
        		}
        		MVHPSON = {
        			DataSource = EPICSCSOutput
        			Type = uint32
        		}
        	+Event = {
        	    Class = Message
        		Destination = StateMachine
        		Function = GoHVArmed
        		Mode = ExpectsReply
        	}
        }
        
        
/*
*  ErrorDetectorGAM gathers all hardware fault signal through EPICS PVs.
*/
        +ErrorDetectGAM = {
        	Class = JAMessageGAM
        	Operation = OR
        	InputSignals = {
        		Error1 = {/*APS error signal */
        			DataSource = EPICSCAInput
        			Type = uint32
        		}
        		Error2 = {/*BPS error signal*/
        			DataSource = EPICSCAInput
        			Type = uint32
        		}
        	}
        	/*When any device emit error, sm go to error state*/
        	+Event = {
        		Class = Message
        		Destination = StateMachine
        		Function = GoError /*State machine needs to receive GoError Event*/
        		Mode = ExpectsReply        	
        	}
        }
        +WritePVGAM = {
        	Class = ConstantGAM
        	OutputSignals = {
        		APSStop = {
        			DataSource = "EPICSCAOutput"
        			Type = uint32
        			Default = 1
        		}
        		BPSStop = {
        		    DataSource = "EPICSCAOutput"
        			Type = uint32
        			Default = 1
        		}
        	}
        }
        +ResetErrorGAM = {
        	Class = JAMessageGAM
        	InputSignals = {
        		ResetError = {/*Detect reset command*/
        			DataSource = EPICSCAInput
        			Type = uint32
        		}
        	}
        	/*When any device emit error, sm go to error state*/
        	+Event = {
        		Class = Message
        		Destination = StateMachine
        		Function = GoReset /*State machine needs to receive GoError Event*/
        		Mode = ExpectsReply        	
        	}        
        }
	}
	
	/* Data node is mandatory*/
    +Data = {
        Class = ReferenceContainer
        DefaultDataSource = DDB1 
        +Timer = {
            Class = LinuxTimer
            SleepNature = "Default"
            SleepPercentage = 30
            ExecutionMode = RealTimeThread
            CPUMask = 0x1
            Signals = {
                Counter = {
                    Type = uint32
                }
                Time = {
                    Type = uint32
                }
            }
        }
        +EPICSCAInput = {
            Class = "EPICSCA::EPICSCAInput"
            CPUMask = "2" /* run on CPU 3 <-- 0100 */
            StackSize = "10000000"
            Signals = {
            
/*
*  PV from signal-variable tab
*/
                Standby = {
                    PVName = "EC-GN-P01-GPF:PLC4110-YTS-ST1R"
                }
                Ready1 = {
                    PVName = "EC-GN-P01-GBF-MCPS:PSU2120-ACT-RB"
                }
                Ready2 = {
                    PVName = "EC-GN-P01-GAF-GCPS:PSU2130-ACT-RB"
                }
                Error1 = {
                	PVName = "EC-GN-P01-PA1F:PSU3000-YFLT"
                }
                Error2 = {
                	PVName = "EC-GN-P01-PB1F:PSU1000-YFLT"
                }
				
				BEAMONPERMIT = {
					PVName = "EC-GN-P01-GAF:PLC4110-CON-GY1PRM"
				}
				
				HVON = {
					PVName = "EC-GN-P01-GPF:PLC4110-YTS-ST3R"
				}
				
/*
*  PV from operation parameter tab
*/	        	
	        	MHVPSDT = {
				    PVName = "EC-GN-P01-PMF:STAT-DT-HVON"
				}
				GYAAPSSWDT = {
					PVName = "EC-GN-P01-PA1F:STAT-DT-HVON"
				}
				GYAAPSSWDT = {	
					PVName = "EC-GN-P01-PA1F:STAT-DT-SWON"
				}
				GYABPSHVDT = {
					PVName = "EC-GN-P01-PB1F:STAT-DT-HVON"
				}
				GYABPSSWDT = {			
					PVName = "EC-GN-P01-PB1F:STAT-DT-SWON"
				}			
				GYBAPSHVDT = {
					PVName = "EC-GN-P01-PA2F:STAT-DT-HVON"
				}
				GYBAPSSWDT = {
					PVName = "EC-GN-P01-PA2F:STAT-DT-SWON"
				}
				GYBBPSHVDT = {
					PVName = "EC-GN-P01-PB2F:STAT-DT-HVON"
				}
				GYBSWONDT = {
					PVName = "EC-GN-P01-PB2F:STAT-DT-SWON"
				}
				GYASHOTLEN = {
					PVName = "EC-GN-P01-GAF:STAT-DT-SHOTLEN"
				}
				GYBSHOTLEN = {
					PVName = "EC-GN-P01-GBF:STAT-DT-SHOTLEN"
				}
				RDYTOUT = {
					PVName = "EC-GN-P01-GPF:STAT-RDY-TOUT"
				}
				MHVPSMANM = {
					PVName = "EC-GN-P01-PMF:STAT-MANM"
				}
				GYAAPSMANM = {
					PVName = "EC-GN-P01-PA1F:STAT-MANM"
				}
				GYABPSMANM = {
					PVName = "EC-GN-P01-PB1F:STAT-MANM"
				}
				GYBAPSMANM = {
					PVName = "EC-GN-P01-PA2F:STAT-MANM"
				}
				GYBBPSMANM = {
					PVName = "EC-GN-P01-PB2F:STAT-MANM"
				}
				GYAMCPSMANM = {
					PVName = "EC-GN-P01-GAF-MCPS:STAT-MANM"
				}
				GYAMCPSMANM = {
					PVName = "EC-GN-P01-GAF-GCPS:STAT-MANM"
				}
				GYAFHPSMANM = {			
					PVName = "EC-GN-P01-GAF-FHPS:STAT-MANM"
				}
				GYACCPSMANM = {
					PVName = "EC-GN-P01-GAF-CCPS:STAT-MANM"
				}
				GYBMCPSMANM = {
					PVName = "EC-GN-P01-GBF-MCPS:STAT-MANM"
				}
				GYBGCPSMANM = {
					PVName = "EC-GN-P01-GBF-GCPS:STAT-MANM
				}
				GYBFHPSMANM = {
					PVName = "EC-GN-P01-GBF-FHPS:STAT-MANM"
				}
				GYBCCPS = {
					PVName = "EC-GN-P01-GBF-CCPS:STAT-MANM"
				}
				GYATRGSOUR = {
					PVName = "EC-GN-P01-GAF:STAT-TRIG-SOUR"
				}
				GYBTRGSOUR = {
					PVName = "EC-GN-P01-GBF:STAT-TRIG-SOUR"
				}
				GYASIMMODE = {			
					PVName = "EC-GN-P01-GAF:STAT-SIMM-MODE"
				}
				GYBSIMMODE = {
					PVName = "EC-GN-P01-GBF:STAT-SIMM-MODE"
				}
				GYAPREPRO = {
					PVName = "EC-GN-P01-GAF:STAT-PREP-MODE"
				}
				GYBPREPRO = {
					PVName = "EC-GN-P01-GBF:STAT-PREP-MODE"
				}
				GYAMSTTRIG = {
					PVName = "EC-GN-P01-GAF:STAT-MST-TRIG"
				}
				GYBMSTTRIG = {
					PVName = "EC-GN-P01-GBF:STAT-MST-TRIG"
				}
                ResetError = {
	        		PVName = "EC-GN-P01-GPF:STAT-RST-FLT"
	        	}
				GYASHOTID = {			
					PVName = "EC-GN-P01-GAF:STAT-SHOT-ID"
				}
				GYBSHOTID = {
					PVName = "EC-GN-P01-GBF:STAT-SHOT-ID"
				}
				GYAAPSPOL = {
					PVName = "EC-GN-P01-PA1F:STAT-POLSW"
				}
				GYBAPSPOL = {
					PVName = "EC-GN-P01-PA2F:STAT-POLSW"
				}
				GYACSVLOAD = {
					PVName = "EC-GN-P01-GAF:STAT-CSV-LOAD"
				}
				GYACSVNAME = {
					PVName = "EC-GN-P01-GAF:STAT-CSV-NAME"
				}
				GYBCSVLOAD = {
					PVName = "EC-GN-P01-GBF:STAT-CSV-LOAD"
				}
				GYBCSVNAME = {
					PVName = "EC-GN-P01-GBF:STAT-CSV-NAME"
				}

            }
        }
        +EPICSCAOutput = {
        	Class = "EPICSCA::EPICSCAOutput"
        	CPUMask = "2"
        	StackSize = "10000000"
        	NumberOfBuffers = 2
        	Signals = {
	        	APSStop = {
	        		PVName = "EC-GN-P01-PA1F:PSU3000-CTRP"
	        	}
	        	BPSStop = {
	        		PVName = "EC-GN-P01-PB1F:PSU1000-CTRP"
	        	}
	        	
				GYASUBSTAT = {
					PVName = "EC-GN-P01-GAF:STAT-FC-SUBSTATE"
				}
				GYBSUBSTAT = {
					PVName = "EC-GN-P01-GBF:STAT-FC-SUBSTATE"
				}
				GYACSVLOADED = {
					PVName = "EC-GN-P01-GAF:STAT-CSV-LOADED"
				}	
				GYACSVERROR = {
					PVName = "EC-GN-P01-GAF:STAT-CSV-ERR"
				}	
				GYBCSVLOADED = {
					PVName = "EC-GN-P01-GBF:STAT-CSV-LOADED"
				}
				GYBCSVERROR = {
					PVName = "EC-GN-P01-GBF:STAT-CSV-ERR"
	        	}
	        	
/*
*  PVs to Analog Output Signals
*/	        	
				GYAFHPSREF = {
					PVName = "EC-GN-P01-GAF-FHPS:PSU2320-EREF"
				}
				GYACCPSREF = {
					PVName = "EC-GN-P01-GAF-CCPS:PSU2610-EREF"
				}
				GYBFHPSREF = {
					PVName = "EC-GN-P01-GBF-FHPS:PSU2320-EREF"
				}
				GYBCCPSREF = {
					PVName = "EC-GN-P01-GBF-CCPS:PSU2610-EREF"
				}
				GYABPSREF = {
					PVName = "EC-GN-P01-PB1F:PSU1000-EREF"
				}
				GYAAPS1REF = {	
					PVName = "EC-GN-P01-PA1F:PSU3000-EREF-P"
				}
				GYAAPS2REF = {	
					PVName = "EC-GN-P01-PA1F:PSU3000-EREF-N"
				}
				MHVPSREF = {	
					PVName = "EC-GN-P01-PMF:PSU0000-EREF"
				}
				GYBBPSREF = {	
					PVName = "EC-GN-P01-PB2F:PSU2000-EREF"
				}
				GYBAPS1REF = {	
					PVName = "EC-GN-P01-PA2F:PSU4000-EREF-P"
				}
				GYBAPS2REF = {	
					PVName = "EC-GN-P01-PA2F:PSU4000-EREF-N"
				}
				
/*
*  PVs to Digital Output Signals
*/
				GYAAPSHVON = {
					PVName = "EC-GN-P01-PA1F:PSU3000-CON-HV"
				}
				GYAAPSSWON = {
					PVName = "EC-GN-P01-PA1F:PSU3000-CON-SW"
				}
				GYAAPSSTOP = {
					PVName = "EC-GN-P01-PA1F:PSU3000-CTRP"
				}
				GYABPSHVON = {
					PVName = "EC-GN-P01-PB1F:PSU1000-CON-HV"
				}
				GYABPSSWON = {
					PVName = "EC-GN-P01-PB1F:PSU1000-CON-SW"
				}
				BYABPSSTOP = {
					PVName = "EC-GN-P01-PB1F:PSU1000-CTRP"
				}
				FCFAULT = {
					PVName = "EC-GN-P01-GAF:FMC4310-YSTA-GAOP"
				}
				MHVPSON = {
					PVName = "EC-GN-P01-PMF:PSU0000-CON-SW"
				}
				MHVPSSTOP = {
					PVName = "EC-GN-P01-PMF:PSU0000-COFF"
				}
				MHVPSMODON = {	
					PVName = "EC-GN-P01-PMF:PSU0000-CON-MOD"
				}
				PCFFAULT = {
					PVName = "EC-GN-P01-GAF:PCF4210-CTRP"
				}
				GYAHVARMED = {
					PVName = "EC-GN-P01-GAF:PCF4210-YTS-GA1"
				}
				GYAHVINJECTION = {	
					PVName = "EC-GN-P01-GAF:PCF4210-YTS-GA2"
				}
				GYARFON = {
					PVName = "EC-GN-P01-GAF:PCF4210-YTS-GA3"
				}
				GYAFHPSRUCMPLT = {
					PVName = "EC-GN-P01-GAF-FHPS:PSU2610-YTS-RUP"
				}
				GYAMCPSRUCMPLT = {
					PVName = "EC-GN-P01-GAF-MCPS:PSU2120-YTS-RUP"
				}
				GYAMCPSRFCMPLT = {	
					PVName = "EC-GN-P01-GAF-MCPS:PSU2120-YTS-RDOWN"
				}
				GYACCPSINOPERATION = {
					PVName = "EC-GN-P01-GAF-CCPS:PSU2320-TR"
				}
				GYBAPSHVON = {
					PVName = "EC-GN-P01-PA2F:PSU4000-CON-HV"
				}
				GYBAPSSWON = {
					PVName = "EC-GN-P01-PA2F:PSU4000-CON-SW"
				}
				GYBAPSSTOP = {
					PVName = "EC-GN-P01-PA2F:PSU4000-CTRP"
				}
				GYBBPSHVON = {
					PVName = "EC-GN-P01-PB2F:PSU2000-CON-HV"
				}
				GYBBPSSWON = {
					PVName = "EC-GN-P01-PB2F:PSU2000-CON-SW"
				}
				GYBBPSSTOP = {
					PVName = "EC-GN-P01-PB2F:PSU2000-CTRP"
				}
				GYBBEAMON = {
					PVName = "EC-GN-P01-GBF:FMS4310-YSTA-GBOP"
				}
				GYBHVARMED = {
					PVName = "EC-GN-P01-GBF:PCF4210-YTS-GB1"
				}
				GYBHVINJECTION = {
					PVName = "EC-GN-P01-GBF:PCF4210-YTS-GB2"
				}
				GYBRFON = {
					PVName = "EC-GN-P01-GBF:PCF4210-YTS-GB3"
				}
				GYBFHPSRUCMPLT = {
					PVName = "EC-GN-P01-GBF-FHPS:PSU2610-YTS-RUP"
				}
				GYBMCPSRUCMPLT = {
					PVName = "EC-GN-P01-GBF-MCPS:PSU2120-YTS-RUP"
				}
				GYBCCPSINOPERATION = {
					PVName = "EC-GN-P01-GBF-CCPS:PSU2320-TR"
				}	

        	}
        }

        +Display = {
            Class = LoggerDataSource
        }
        +Timings = {
            Class = TimingDataSource
        }
    }
    +States = {
        Class = ReferenceContainer
        +WaitStandby = {
            Class = RealTimeState
            +Threads = {
                Class = ReferenceContainer
                +Thread1 = {
                    Class = RealTimeThread
                    /* Add GAMs to be executed.*/
                    Functions = {TimerGAM WaitStandbyMessageGAM ErrorDetectGAM}
                    CPUMask = 0x1
                }
            }
        }
        +Offline = {
            Class = RealTimeState
            +Threads = {
                Class = ReferenceContainer
                +Thread1 = {
                    Class = RealTimeThread
                    /*
                    *  RTApp Offline state check operation parameter changes.
                    *  When PLC SM becomes STANDBY State, PCF SM starts Coil Power Supplies Setup.
                    *  If Coil Power Supplies is ready, Move to WaitPermit state.
                    */
                    Functions = {TimerGAM PreProgrammedGAM OfflineMessageGAM ErrorDetectGAM}
                    CPUMask = 0x1
                }
            }
        }
        +WaitPermit = {
            Class = RealTimeState
            +Threads = {
                Class = ReferenceContainer
                +Thread1 = {
                    Class = RealTimeThread
                    /*
                    *  In the WatiPermit state, it is possible to change PrePro parameters.
                    */
                    Functions = {TimerGAM PreProgrammedGAM WaitPermitMessageGAM ErrorDetectGAM}
                    CPUMask = 0x1
                }
            }
        }        
        +PreHeating = {
            Class = RealTimeState
            +Threads = {
                Class = ReferenceContainer
                +Thread1 = {
                    Class = RealTimeThread
                    /*
                    *  If PrePro == ON, then, start PrePro Sequence. Oherwise, pass through this state.
                    */
                    Functions = {TimerGAM PreHeatingMessageGAM ErrorDetectGAM}
                    CPUMask = 0x1
                }
            }
        }
        +WaitReady = {
            Class = RealTimeState
            +Threads = {
                Class = ReferenceContainer
                +Thread1 = {
                    Class = RealTimeThread
                    /*
                    *  Check componets ready signals. All signals are ready, then move to WaitHVON state.
                    */
                    Functions = {TimerGAM WaitReadyMessageGAM ErrorDetectGAM}
                    CPUMask = 0x1
                }
            }
        }
        +WaitHVON = {
            Class = RealTimeState
            +Threads = {
                Class = ReferenceContainer
                +Thread1 = {
                    Class = RealTimeThread
                    /*
                    *  Wait one trigger (HVON). 
                    */
                    Functions = {TimerGAM WaitHVONMessageGAM ErrorDetectGAM}
                    CPUMask = 0x1
                }
            }
        }
        +HVArming = {
            Class = RealTimeState
            +Threads = {
                Class = ReferenceContainer
                +Thread1 = {
                    Class = RealTimeThread
                    /*
                    *  When Enter this state, turn on APS and BPS HVON.
                    *  When both HVPS are ON, move to HVArmed state.
                    */
                    Functions = {TimerGAM HVArmingMeaageGAM ErrorDetectGAM}
                    CPUMask = 0x1
                }
            }
        }
        +HVArmed = {
            Class = RealTimeState
            +Threads = {
                Class = ReferenceContainer
                +Thread1 = {
                    Class = RealTimeThread
                    /*
                    *  Wait until MHVPS is enabled or BPS SW is ON.
                    */
                    Functions = {TimerGAM HVArmedMessageGAM ErrorDetectGAM}
                    CPUMask = 0x1
                }
            }
        }
        +HVInjection = {
            Class = RealTimeState
            +Threads = {
                Class = ReferenceContainer
                +Thread1 = {
                    Class = RealTimeThread
                    /*
                    *  Wait until APS ON.
                    *  
                    */
                    Functions = {TimerGAM HVInjectionMessageGAM ErrorDetectGAM}
                    CPUMask = 0x1
                }
            }
        }
        +RFON = {
            Class = RealTimeState
            +Threads = {
                Class = ReferenceContainer
                +Thread1 = {
                    Class = RealTimeThread
                    /*
                    *  Wait until Shot Length. When it takes shotlen time, move to HVArmed state.
                    */
                    Functions = {TimerGAM RFONMessageGAM ErrorDetectGAM}
                    CPUMask = 0x1
                }
            }
        }
        
        +Error = {
        	Class = RealTimeState
        	+Threads = {
        		Class = ReferenceContainer
        		+Thread1 = {
        			Class = RealTimeThread
        			Functions = {WritePVGAM ResetErrorGAM}
        			CPUMask = 0x1
        		}
        	}
        }
    }
    +Scheduler = {
        Class = GAMScheduler
        TimingDataSource = Timings
    }
}